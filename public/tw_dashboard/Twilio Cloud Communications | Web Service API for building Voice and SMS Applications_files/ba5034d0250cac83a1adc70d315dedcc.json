var UasActiveTag;(function(t){var e=function(){function h(){}h.encode=function(t){var e="";var r,n,i,a,o,s,c;var u=0;var p=h._utf8_encode(t);while(u<p.length){r=p.charCodeAt(u++);n=p.charCodeAt(u++);i=p.charCodeAt(u++);a=r>>2;o=(r&3)<<4|n>>4;s=(n&15)<<2|i>>6;c=i&63;if(isNaN(n)){s=c=64}else if(isNaN(i)){c=64}e=e+this.keyStr.charAt(a)+this.keyStr.charAt(o)+this.keyStr.charAt(s)+this.keyStr.charAt(c)}return e};h.decode=function(t){var e="";var r,n,i;var a,o,s,c;var u=0;var p=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(u<p.length){a=this.keyStr.indexOf(p.charAt(u++));o=this.keyStr.indexOf(p.charAt(u++));s=this.keyStr.indexOf(p.charAt(u++));c=this.keyStr.indexOf(p.charAt(u++));r=a<<2|o>>4;n=(o&15)<<4|s>>2;i=(s&3)<<6|c;e=e+String.fromCharCode(r);if(s!=64){e=e+String.fromCharCode(n)}if(c!=64){e=e+String.fromCharCode(i)}}e=h._utf8_decode(e);return e};h._utf8_encode=function(t){var e=t.replace(/\r\n/g,"\n");var r="";for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i<128){r+=String.fromCharCode(i)}else if(i>127&&i<2048){r+=String.fromCharCode(i>>6|192);r+=String.fromCharCode(i&63|128)}else{r+=String.fromCharCode(i>>12|224);r+=String.fromCharCode(i>>6&63|128);r+=String.fromCharCode(i&63|128)}}return r};h._utf8_decode=function(t){var e="";var r=0;var n=0,i=0,a=0,o=0;while(r<t.length){n=t.charCodeAt(r);if(n<128){e+=String.fromCharCode(n);r++}else if(n>191&&n<224){a=t.charCodeAt(r+1);e+=String.fromCharCode((n&31)<<6|a&63);r+=2}else{a=t.charCodeAt(r+1);o=t.charCodeAt(r+2);e+=String.fromCharCode((n&15)<<12|(a&63)<<6|o&63);r+=3}}return e};h.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return h}();t.Base64=e})(UasActiveTag||(UasActiveTag={}));var UasActiveTag;(function(t){var e=function(){function e(t){this.value=t}e.some=function(t){return new e(t)};e.none=function(){return new e(null)};e.prototype.ifPresent=function(t){if(!!this.value){t(this.value)}return this};e.prototype.isEmpty=function(){return!this.value};e.prototype.orElse=function(t){if(!this.value){t()}return this};e.prototype.becomeSome=function(t){this.value=t;return this};e.prototype.becomeNone=function(){this.value=null;return this};return e}();t.Maybe=e})(UasActiveTag||(UasActiveTag={}));var __extends=this&&this.__extends||function(){var n=function(t,e){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]};return n(t,e)};return function(t,e){n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();var UasActiveTag;(function(r){r.PageViewEvent="pageView";r.ItemSearchEvent="itemSearch";r.ItemViewEvent="itemView";r.CategoryViewEvent="categoryView";r.BasketViewEvent="basketView";r.BasketAddEvent="basketAdd";r.BasketRemoveEvent="basketRemove";r.CheckoutStartEvent="checkoutStart";r.CheckoutEndEvent="checkoutEnd";r.PassthroughEvent="passthrough";r.CustomEvent="customEvent";r.TravelItemSearchEvent="travelItemSearch";r.TravelCheckoutEndEvent="travel-checkoutEnd";var n=function(){function t(){}t.getPageType=function(t){var e;switch(t){case r.PageTypeHome:case i:e=r.PageTypeHome;break;case r.PageTypeSearch:e=r.PageTypeSearch;break;case r.PageTypeCategory:e=r.PageTypeCategory;break;case r.PageTypeProduct:e=r.PageTypeProduct;break;case r.PageTypeBasket:case a:e=r.PageTypeBasket;break;case r.PageTypeSearch:e=r.PageTypeSearch;break;case r.PageTypeCheckoutStart:case r.CheckoutStartEvent:e=r.PageTypeCheckoutStart;break;case r.PageTypeCheckoutEnd:case r.CheckoutEndEvent:e=r.PageTypeCheckoutEnd;break;case r.PageTypeSignIn:e=r.PageTypeSignIn;break;case r.PageTypeSignOut:e=r.PageTypeSignOut;break;case r.PageTypeSignUpStart:e=r.PageTypeSignUpStart;break;case r.PageTypeSignUpEnd:e=r.PageTypeSignUpEnd;break;case r.PageTypeAllPages:e=r.PageTypeAllPages;break;case r.PageTypeNewsletterSignUpStart:e=r.PageTypeNewsletterSignUpStart;break;case r.PageTypeNewsletterSignUpEnd:case o:e=r.PageTypeNewsletterSignUpEnd;break;case r.PageTypeWithdraw:e=r.PageTypeWithdraw;break;default:e=r.PageTypeOther}return e};return t}();r.PageTypeFactory=n;r.PageTypeHome="home";r.PageTypeProduct="product";r.PageTypeCategory="category";r.PageTypeSearch="search";r.PageTypeBasket="basket";r.PageTypeCheckoutStart="checkout-start";r.PageTypeCheckoutEnd="checkout-end";r.PageTypeAllPages="all-pages";r.PageTypeOther="other";r.PageTypeSignIn="sign-in";r.PageTypeSignOut="sign-out";r.PageTypeSignUpStart="signup-start";r.PageTypeSignUpEnd="signup-end";r.PageTypeNewsletterSignUpStart="newsletter-signup-start";r.PageTypeNewsletterSignUpEnd="newsletter-signup-end";r.PageTypeWithdraw="withdraw";var i="homepage";var a="cart";var o="newsletter";var t=function(){function t(){this.currency=""}t.prototype.setExtraData=function(t){this.extraData=t;return this};t.prototype.setCurrency=function(t){this.currency=t;return this};t.prototype.arrayToList=function(t){if(!!t){return Array.isArray(t)?t.join(","):t}};return t}();r.BaseStandardEventDataBuilder=t;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.valueOfItems=0;t.numberOfItems=0;return t}t.prototype.setValueOfItems=function(t){this.valueOfItems=t;return this};t.prototype.setNumberOfItems=function(t){this.numberOfItems=t;return this};return t}(t);r.FunnelEventDataBuilder=e;var s=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.allowDefault=false;return t}t.prototype.shouldAllowDefault=function(t){this.allowDefault=t;return this};t.prototype.setPageType=function(t){var e=n.getPageType(t);if(!!t&&e==r.PageTypeOther){throw new Error("Must be a valid page type or set allow default flag")}this.pageType=e;return this};t.prototype.build=function(){if(!this.pageType){if(!this.allowDefault){throw new Error("A valid page type must be provided or default enabled")}this.pageType=r.PageTypeOther}return{eventType:r.PageViewEvent,pageType:this.pageType,extraData:this.extraData}};return t}(t);r.PageViewEventDataBuilder=s;var c=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.subCategory="";return t}t.prototype.setCategory=function(t){this.category=t;return this};t.prototype.setSubCategory=function(t){this.subCategory=t;return this};t.prototype.build=function(){if(!this.category){throw new Error("A category is required!")}return{eventType:r.CategoryViewEvent,category:this.category,subcategory:this.subCategory,extraData:this.extraData}};return t}(t);r.CategoryViewEventDataBuilder=c;var u=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.productId="";t.name="";t.category="";t.subcategory="";t.price=0;return t}t.prototype.setSku=function(t){this.sku=t;return this};t.prototype.setProductId=function(t){this.productId=t;return this};t.prototype.setName=function(t){this.name=t;return this};t.prototype.setCategory=function(t){this.category=t;return this};t.prototype.setSubCategory=function(t){this.subcategory=t;return this};t.prototype.setPrice=function(t){this.price=t;return this};t.prototype.setCurrency=function(t){this.currency=t;return this};t.prototype.build=function(){if(!this.sku||this.sku.trim().length===0){throw new Error("A product must have a sku")}return{eventType:r.ItemViewEvent,sku:this.sku,productId:this.productId,name:this.name,category:this.category,subcategory:this.subcategory,price:this.price,currency:this.currency,extraData:this.extraData}};return t}(t);r.ItemViewEventDataBuilder=u;var p=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.build=function(){return{eventType:r.BasketViewEvent,numberOfItems:this.numberOfItems,valueOfItems:this.valueOfItems,currency:this.currency,extraData:this.extraData}};return e}(e);r.BasketViewEventDataBuilder=p;var h=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.skuString="";t.productIdString="";t.priceString="";t.quantitystring="";t.nameString="";t.categoryString="";t.subcategoryString="";return t}t.prototype.setPriceString=function(t){this.priceString=this.arrayToList(t);return this};t.prototype.setQuantityString=function(t){this.quantitystring=this.arrayToList(t);return this};t.prototype.setNameString=function(t){this.nameString=this.arrayToList(t);return this};t.prototype.setCategoryString=function(t){this.categoryString=this.arrayToList(t);return this};t.prototype.setSubcategoryString=function(t){this.subcategoryString=this.arrayToList(t);return this};t.prototype.setSkuString=function(t){this.skuString=this.arrayToList(t);return this};t.prototype.setProductIdString=function(t){this.productIdString=this.arrayToList(t);return this};return t}(e);r.CheckoutEventDataBuilder=h;var f=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.item={sku:"",productId:"",name:"",category:"",subcategory:"",price:0,quantity:0};return t}t.prototype.setItem=function(e){var r=this;Object.keys(this.item).forEach(function(t){if(!!e[t]){r.item[t]=e[t]}});return this};t.prototype.build=function(){return{eventType:r.BasketAddEvent,item:this.item,numberOfItems:this.numberOfItems,valueOfItems:this.valueOfItems,extraData:this.extraData}};return t}(e);r.BasketAddEventDataBuilder=f;var d=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.build=function(){return{eventType:r.CheckoutStartEvent,valueOfItems:this.valueOfItems,numberOfItems:this.numberOfItems,currency:this.currency,skuString:this.skuString,productIdString:this.productIdString,priceString:this.priceString,quantityString:this.quantitystring,nameString:this.nameString,categoryString:this.categoryString,subcategoryString:this.subcategoryString,extraData:this.extraData}};return e}(h);r.CheckoutStartEventDataBuilder=d;var l=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.offerCode="";return t}t.prototype.setOrderId=function(t){this.orderId=t;return this};t.prototype.setOfferCode=function(t){this.offerCode=this.offerCode;return this};t.prototype.build=function(){if(!this.orderId||this.orderId.trim().length==0){throw new Error("A checkout end event must contain an orderID")}return{eventType:r.CheckoutEndEvent,orderId:this.orderId,valueOfItems:this.valueOfItems,numberOfItems:this.numberOfItems,currency:this.currency,skuString:this.skuString,productIdString:this.productIdString,priceString:this.priceString,quantityString:this.quantitystring,nameString:this.nameString,categoryString:this.categoryString,subcategoryString:this.subcategoryString,offerCode:this.offerCode,extraData:this.extraData}};return t}(h);r.CheckoutEndEventDataBuilder=l;var y=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.setSearchTerm=function(t){this.searchTerm=t;return this};e.prototype.build=function(){return{eventType:r.ItemSearchEvent,searchTerm:this.searchTerm,extraData:this.extraData}};return e}(t);r.ItemSearchEventDataBuilder=y})(UasActiveTag||(UasActiveTag={}));var UasActiveTag;(function(e){var r=function(){function e(t,e){this._location=e;this._found=false;this._oneShot=false;if(t!==null){this._found=t.test(this._location.href)}}e.prototype.ifFound=function(t){if(this._found&&!this._oneShot){this._oneShot=true;t(this._location)}return this};e.prototype.orElse=function(t){if(!this._found){t(this._location)}};e.prototype.orElseFilter=function(t){if(!this._found){return new e(t,this._location)}else{return this}};return e}();var n=function(){function t(t){var r=this;this._href=t;this._params={};var e=this._href.split("?");if(e.length==2){e[1].split("&").forEach(function(t){var e=t.split("=");r._params[e[0]]=decodeURIComponent(e[1])})}}Object.defineProperty(t.prototype,"href",{get:function(){return this._href},enumerable:false,configurable:true});t.prototype.filter=function(t){return new r(t,this)};t.prototype.hasParam=function(t){return"undefined"!==typeof this._params[t]};t.prototype.getParam=function(t){return this._params[t]};return t}();var t=function(){function t(t,e){this._values=e;this._location=new n(t)}t.prototype.filter=function(t,r){var n=this;var i=e.Maybe.none();this._location.filter(t).ifFound(function(t){var e=n._values.filter(r);if(e.length>0){i.becomeSome(e[0])}});return i};Object.defineProperty(t.prototype,"values",{get:function(){return this._values},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"location",{get:function(){return this._location},enumerable:false,configurable:true});return t}();e.DataLayerEvents=t})(UasActiveTag||(UasActiveTag={}));var UasActiveTag;(function(a){var t=function(){function t(t,e,r){if(t===void 0){t=""}if(r===void 0){r=""}this._advertiserId=t;this._pixelId=e;this._currency=r;this._mappers=[]}t.prototype.map=function(e){var r=this;this._mappers.push(function(t){return e.apply(r,[t])})};Object.defineProperty(t.prototype,"mappers",{get:function(){return this._mappers},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"advertiserId",{get:function(){return this._advertiserId},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"pixelId",{get:function(){return this._pixelId},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"advertiserUserId",{get:function(){return this._advertiserUid},set:function(t){this._advertiserUid=t},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"currency",{get:function(){return this._currency},set:function(t){this._currency=t},enumerable:false,configurable:true});t.prototype.decodeString=function(t){return decodeURI(t)};t.prototype.formatString=function(t,e){var r=t.replace(/[^\d\.\,\s]+|,|\.|\s/g,"");r=r.slice(0,-e)+"."+r.slice(-e);return r};t.prototype.cleanNumeric=function(t,e){if(e===void 0){e=2}var r=this.formatString(this.decodeString(t),e);return parseFloat(r)};t.prototype.urlPathToArray=function(){var t=window.location.pathname;var e=t.length;if(e>1){if(t.indexOf("/")===0){t=t.substring(1,t.length);e--}if(t.lastIndexOf("/")===e-1){t=t.substring(0,e-1)}}else{t=""}return t.length>0?t.split("/"):[]};t.prototype.nullOrUndefinedToEmpty=function(t){if(!!t){return t}return""};return t}();a.PixelMapper=t;var e=function(){function t(t,e,r){if(e===void 0){e=window["dataLayer"]}if(r===void 0){r="UasActiveTag"}this.mapper=t;this._dataLayerVariable=e;this._namespacePrefix=r;this.XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.6.0")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];this.activeId=null;this.containerId=null;this.cst=null;this.gdprConsent=null;try{var n=this.parseParameters();if("undefined"!==typeof n["caid"]){this.activeId=n["caid"]}if("undefined"!==typeof n["coid"]){this.containerId=n["coid"]}if("undefined"!==typeof n["cst"]){this.cst=n["cst"]}if("undefined"!==typeof n["gdpr_consent"]){this.gdprConsent=n["gdpr_consent"]}}catch(t){console.error(t)}}Object.defineProperty(t.prototype,"namespacePrefix",{get:function(){return this._namespacePrefix},set:function(t){this.namespacePrefix=t},enumerable:false,configurable:true});t.prototype.run=function(){var e=this;var r=this.namespacePrefix+"."+this.mapper.pixelId;if("undefined"===typeof window[r]){window[r]={lastProcessedEvent:-1}}else if(!window[r].lastProcessedEvent){window[r].lastProcessedEvent=-1}var n=window.location.href.split("?")[0];if(this._dataLayerVariable===null){this.processDataLayer(n,[])}else{var i=0;var a=window.setInterval(function(){if("undefined"!==typeof e._dataLayerVariable){window.clearInterval(a);var t=void 0;if(e._dataLayerVariable instanceof Array){t=e._dataLayerVariable.slice(window[r].lastProcessedEvent+1,e._dataLayerVariable.length);window[r].lastProcessedEvent=e._dataLayerVariable.length-1}else if(Object.keys(e._dataLayerVariable).length){t=[e._dataLayerVariable]}if(t.length>0){e.processDataLayer(n,t)}}else{if(++i>10){window.clearInterval(a);e.processDataLayer(n,[])}}},1e3)}};t.prototype.processDataLayer=function(t,e){var r=this;var n=new a.DataLayerEvents(t,e);var i=[];this.mapper.mappers.forEach(function(t){try{t(n).ifPresent(function(t){if(t instanceof Array){t.forEach(function(t){return i.push(t)})}else{i.push(t)}})}catch(t){console.log(t);r.sendError(t)}});if(i.length>0){this.dispatchEvents(i)}};t.prototype.dispatchEvent=function(t){this.dispatchEvents([t])};t.prototype.processEventResponse=function(t){try{var e=document.createElement("iframe");e.frameBorder="0";e.scrolling="no";e.marginWidth="0";e.marginHeight="0";e.style.cssText="display: none; visibility: hidden;";document.body.appendChild(e);e.contentWindow.document.open();e.contentWindow.document.write(t);e.contentWindow.document.close()}catch(t){console.error(t)}};t.prototype.hashCode=function(t){var r=[];var e=JSON.stringify(t,function(t,e){if(typeof e==="object"&&e!==null){if(r.indexOf(e)!==-1){return}r.push(e)}return e});var n=0;if(e.length==0)return n;for(var i=0;i<e.length;i++){var a=e.charCodeAt(i);n=(n<<5)-n+a;n=n&n}return n};t.prototype.createXMLHTTPObject=function(){var t=false;for(var e=0;e<this.XMLHttpFactories.length;e++){try{t=this.XMLHttpFactories[e]()}catch(t){continue}break}return t};t.prototype.parseParameters=function(){var i={};var t=null;for(var e=0;e<document.scripts.length;e++){var r=document.scripts[e].src;if(r.indexOf(this.mapper.pixelId)>=0){t=r;break}}if(t!==null){var n=t.split("?");if(n.length===2){var a=n[1];var o=a.split("&");o.forEach(function(t){var e=t.split("=");var r=decodeURIComponent(e[0]);var n=decodeURIComponent(e.length>1?e[1]:"");i[r]=n})}}return i};return t}();a.PixelManager=e})(UasActiveTag||(UasActiveTag={}));var UasActiveTag;(function(o){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.BASE_REQUEST_URL="https://i.ctnsnet.com/int/uas?pixel=";return t}t.prototype.dispatchEvents=function(t){var e=this;try{var r="event=scrape";if(!!this.activeId){r+="&caid="+this.activeId}if(!!this.containerId){r+="&coid="+this.containerId}if(!!this.mapper.advertiserUserId){r+="&advuid="+this.mapper.advertiserUserId}if(!!this.cst){r+="&cst="+this.cst}if(!!this.gdprConsent){r+="&gdpr_consent="+this.gdprConsent}try{r+="&loc="+encodeURIComponent(document.location.toString())}catch(t){}try{r+="&ref="+encodeURIComponent(document.referrer.toString())}catch(t){}r+="&x="+(new Date).getTime().toString();var n=""+this.BASE_REQUEST_URL+this.mapper.pixelId+"&cont=f&"+r;var i=o.Base64.encode(JSON.stringify(t));var a=this.createXMLHTTPObject();a.withCredentials=true;a.onreadystatechange=function(){var t=XMLHttpRequest.DONE||4;if(a.readyState===t&&a.status===200){e.processEventResponse(a.responseText)}};a.open("POST",n,true);a.setRequestHeader("Accept","text/html");a.send(i)}catch(t){this.sendError(t)}};t.prototype.sendError=function(t){try{var e="event=error&";try{e+="loc="+encodeURIComponent(document.location.toString())+"&"}catch(t){}try{e+="ref="+encodeURIComponent(document.referrer.toString())+"&"}catch(t){}try{e+="v="+encodeURIComponent(t.message)+"&"}catch(t){}e+="x="+(new Date).getTime().toString();var r=""+this.BASE_REQUEST_URL+this.mapper.pixelId+"&cont=f&"+e;var n=document.createElement("img");n.setAttribute("src",r);n.style.display="none";n.style.width="0";n.style.height="0";document.body.appendChild(n)}catch(t){console.error(t)}};return t}(o.PixelManager);o.UasPixelManager=t})(UasActiveTag||(UasActiveTag={}));var UasActiveTag;(function(n){var t=function(e){__extends(t,e);function t(t){var r=e.call(this,undefined,t)||this;r._page=window.location.href;r.map(function(t){var e=n.Maybe.none();e.becomeSome({eventType:n.PageViewEvent,pageType:n.PageTypeAllPages,extraData:{page:r._page,market:r.getMarket()}});return e});return r}t.prototype.getMarket=function(){return"UK"};t.prototype.generateClickEvent=function(t){r.dispatchEvent({eventType:n.CheckoutEndEvent,extraData:{market:this.getMarket(),eventName:t}})};t.prototype.listenByTalkToAnExpert=function(){var e=this;var t=document.querySelectorAll('[href="/help/sales"]');var r=document.querySelectorAll('[href="/try-twilio"]');if(!!t&&t.length>0){for(var n=0;n<t.length;n++){var i=t[n];i.addEventListener("click",function(t){return e.generateClickEvent("TalkToAnExpert")})}}if(!!r&&r.length>0){for(var n=0;n<r.length;n++){var i=r[n];i.addEventListener("click",function(t){return e.generateClickEvent("SignUpForm")})}}};return t}(n.PixelMapper);var e=new t("67777035");var r=new n.UasPixelManager(e);e.listenByTalkToAnExpert();r.run()})(UasActiveTag||(UasActiveTag={}));