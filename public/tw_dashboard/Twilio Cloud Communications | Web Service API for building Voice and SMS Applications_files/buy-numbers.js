function searchTermToRegexAndReplace(e,t,i){if(""===e)return[null,""];for(var a="",r=1,o=e.replace(/\s+/gi,"").split(""),l="",n=0;n<o.length;n++){var s=o[n];n>0&&(a+="$"+r,r++,l+="([-() ]*)"),a+=s.match(/[a-z\+]/i)?s.toUpperCase():"$"+r,r++;var c;c="%"!=s?escapeRegExp(letterToNumber(s)).replace("*","[0-9]"):".*",l+="("+c+")"}"right"===t&&(l+="$");var u=new RegExp(l,i);return[u,a]}function replacePastIndex(e,t,i,a){a=a||0;var r=e.substring(0,a);return e=e.substring(a),r+e.replace(t,i)}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")}function letterToNumber(e){var t="22233344455566677778889999",i=e.toLowerCase().charCodeAt(0)-97;return i<0||i>25?e:t[i]}var twilio=twilio||{};/*<sl:notranslate>*/
twilio.buyNumber={modalSelector:"@confirm-buy-number-modal",pageSelector:"@buy-number-page",betaCheckboxSelector:"@beta-option",capabilitiesMessageSelector:".capabilities-message",currentCountry:{isoCode:"US",friendlyName:"United States",countryCode:"+1",capabilities:"local voice,local sms,tollfree voice,tollfree sms,search by location"},isUpdatingCountry:!1,types:["local","mobile","tollfree"],capabilities:["voice","sms","mms","fax"],disabledCapabilities:[],initialized:!1,HIDDEN_CLASS:"hide",/*</sl:notranslate>*/
init:function(){$("body").on("hide",this.modalSelector,function(){$(this).find(".modal-body.purchase-complete").length&&window.location.reload()}),$(this.pageSelector).on("click","@swap",function(e){e.preventDefault();var t=$("#basicSearch"),i=$("#advancedSearch");i.hasClass(twilio.buyNumber.HIDDEN_CLASS)?(twilio.buyNumber.copyCapabilityCheckboxesState(t),t.addClass(twilio.buyNumber.HIDDEN_CLASS),i.removeClass(twilio.buyNumber.HIDDEN_CLASS)):(i.addClass(twilio.buyNumber.HIDDEN_CLASS),t.removeClass(twilio.buyNumber.HIDDEN_CLASS),twilio.buyNumber.copyCapabilityCheckboxesState(i))}),twilio.buyNumber.initInputs(),window.location.href.indexOf("results")==-1&&$(twilio.buyNumber.betaCheckboxSelector).prop("checked",!0),twilio.buyNumber.updateCurrentCountry($(".country").val()),twilio.buyNumber.highlightSearchTerm(),twilio.buyNumber.eventHandlers(),twilio.buyNumber.updateSearchType(!1),twilio.buyNumber.initialized=!0},copyCapabilityCheckboxesState:function(e){e.find("label.anyCapability, label.sms, label.mms, label.voice, label.fax").each(function(){var e=$(this),t=e.find("input"),i=t.attr("id").split("-"),a=i[0],r=i[1],o="basic"==r?"advanced":"basic",l="#"+a+"-"+o,n=$(l),s=n.parent();e.hasClass("checked")?(n.prop("checked",!0),s.addClass("checked")):(n.prop("checked",!1),s.removeClass("checked"))})},initInputs:function(){$(".country").selectize({render:{option:twilio.buyNumber.renderOption,item:twilio.buyNumber.renderOption},onChange:function(e){twilio.buyNumber.isUpdatingCountry||twilio.buyNumber.updateCurrentCountry(e)}}),$("select").selectize()},renderOption:function(e,t){var i="";if(twilio.buyNumber.countryData[e.value].countryCode)var i='&emsp;<span class="text-muted">('+twilio.buyNumber.countryData[e.value].countryCode+")</span>";return'<div><div class="flag-14 '+t(e.value.toLowerCase())+'"></div>&emsp;<strong>'+t(twilio.buyNumber.countryData[e.value].friendlyName)+"</strong>"+i+"</div>"},renderCondensedOption:function(e,t){return'<div><div class="flag-14 '+t(e.value.toLowerCase())+'"></div>&emsp;<strong>'+t(e.text)+"</strong></div>"},eventHandlers:function(){$(".number-form select").each(function(){var e=$(this).attr("name"),t=!1;$('select[name="'+e+'"]').change(function(e){if(t)return void e.stopPropagation();t=!0;var i=$(this),a=i.attr("name"),r=!0;"align"!=a&&"searchType"!=a||(r=!1);var o=i.val(),l=i.closest(".number-form").attr("id"),n=$(".number-form:not(#"+l+') select[name="'+a+'"]');n.each(function(){this.selectize&&this.selectize.setValue(o),twilio.buyNumber.updateSearchType(twilio.buyNumber.initialized&&r)});var s=$('input[type="hidden"][name="'+a+'"]');s.val(o),t=!1})}),$("input:text").change(function(){var e=$(this);$('input[name="'+e.prop("name")+'"]').prop("value",e.prop("value"))}),$(this.pageSelector+", @buy-number-modal").on("change","@check-control :radio, @check-control :checkbox",function(){var e=$(this),t=e.closest("@check-control"),i=e.attr("name"),a=e.val(),r=t.find('[name="'+i+'"]'),o=r.filter(":checkbox"),l=r.filter(":radio"),n=r.filter('[type="hidden"]'),s=r.filter('[value="'+a+'"]'),c=(s.filter('[type="hidden"]'),0!==o.length),u=e.prop("checked");if(s.prop("checked",u),c){var d=o.filter(":not(:disabled)"),b=d.filter(":checked");e.is(":radio")?d.prop("checked",!e.is(":checked")):0===b.length?l.prop("checked",!0):l.prop("checked",!1),n.prop("disabled",!0),r.filter(":checked").each(function(){n.filter('[value="'+$(this).val()+'"]').prop("disabled",!1)})}else n.val(a);twilio.buyNumber.updateForm()}).filter(":checked").trigger("change"),$('[name="align"]').change(twilio.buyNumber.updateForm),$('[name="type[]"]').change(twilio.buyNumber.updateForm),$('[name="certification"]').change(twilio.buyNumber.updateForm),$("@enter-submit").keydown(function(e){13===e.keyCode&&($(this).closest("form").submit(),e.preventDefault())})},highlightSearchTerm:function(){if("number"==$("#searchType").val()){var e=$('input[name="searchTerm"]').val();0==e.indexOf(twilio.buyNumber.currentCountry.countryCode)&&(e=e.substr(twilio.buyNumber.currentCountry.countryCode.length));var t=e.match(/[a-z]/i),i=$("#align").val()||"left",a="anywhere"===i?"g":"",r=searchTermToRegexAndReplace(e,i,a),o=r[0],l=r[1];$(".phone-number").each(function(){for(var e=$(this),i=e.text().replace(/^\+/,""),r='<span class="highlight highlight-info">',n="</span>",s=i.match(o)||[],c="g"===a?s.length:1,u=0;u<c;u++){var d=s[u];if(d){var b=t?d.replace(o,l):d;i=replacePastIndex(i,d,r+b+n,s.index)}}e.html(i).removeClass("hide")})}},getCurrentCountryCapabilities:function(){var e=[];$('input[name="type[]"]:checkbox:checked').each(function(){e.push($(this).val())}),e.length||(e=["local","mobile","tollfree"]);for(var t={},i=0;i<twilio.buyNumber.capabilities.length;i++){var a=twilio.buyNumber.capabilities[i];t[a]=!1;for(var r=0;r<e.length;r++){var o=e[r],l=o+" "+a;"fax"==a&&(l="fax"),twilio.buyNumber.currentCountry.capabilities.indexOf(l)>=0&&(t[a]=!0)}}return t},updateForm:function(){var e=function(e){return"number"===e||twilio.buyNumber.currentCountry.capabilities.indexOf("search by "+e)>=0},t=$(".number-drop-down"),i=$(".number-input"),a=$("#searchType")[0];if(a){var r=a.selectize,o=e("location");o?(t.removeClass("hide"),i.addClass("hide"),t.find('input[type="text"][name="searchTerm"]').prop("disabled",!1),i.find('input[type="text"][name="searchTerm"]').prop("disabled",!0)):(r.setValue("number"),t.addClass("hide"),i.removeClass("hide"),t.find('input[type="text"][name="searchTerm"]').prop("disabled",!0),i.find('input[type="text"][name="searchTerm"]').prop("disabled",!1));for(var l=0;l<twilio.buyNumber.types.length;l++){var n=twilio.buyNumber.types[l],s=$('[name="type[]"][value="'+n+'"]'),c=twilio.buyNumber.currentCountry.capabilities.indexOf(n)>=0;s.prop("disabled",!c),s.parent("label")[c?"removeClass":"addClass"]("text-muted"),c?s.each(function(){$(this).closest("label").removeClass("disabled")}):s.each(function(){$(this).closest("label").addClass("disabled")}),c?s.is(":checked")||s.filter('[type="hidden"]').prop("disabled",!0):s.prop("checked",!1)}var u=0==$('input[name="type[]"][type="checkbox"]:checked').length,d=$("#anyType");u&&d.prop("checked",!0),d.filter('[type="hidden"]').prop("disabled",!u);var b=twilio.buyNumber.getCurrentCountryCapabilities();for(var p in b){var m=$("#"+p+"-basic"),h=$("#"+p+"-advanced"),y=$("#"+p+"-condensed");b.hasOwnProperty(p)&&b[p]?(twilio.buyNumber.isCapabilityKeptDisabled(p)||(m.attr("disabled",!1),h.attr("disabled",!1),y.attr("disabled",!1)),m.parent("label").removeClass("text-muted").removeClass("disabled"),h.parent("label").removeClass("text-muted").removeClass("disabled"),y.parent("li").removeClass("text-muted").removeClass("disabled")):(twilio.buyNumber.isCapabilityKeptDisabled(p)||(m.prop("checked",!1),h.prop("checked",!1),y.prop("checked",!1),m.attr("disabled",!0),h.attr("disabled",!0),y.attr("disabled",!0)),m.parent("label").addClass("text-muted").addClass("disabled"),h.parent("label").addClass("text-muted").addClass("disabled"),y.parent("li").addClass("text-muted").addClass("disabled"))}0==$('input[name="capability[]"]:checked').length&&$("#anyCapability-advanced, #anyCapability-condensed, #anyCapability-basic").prop("checked",!0),twilio.buyNumber.setCountryCapabilitiesInfoMessage(b);var f=twilio.buyNumber.currentCountry.beta;f||$(twilio.buyNumber.betaCheckboxSelector).prop("checked",!1),$(twilio.buyNumber.betaCheckboxSelector).prop("disabled",!f),$(twilio.buyNumber.betaCheckboxSelector).parent("label")[f?"removeClass":"addClass"]("disabled");var C=$("#advancedSearch"),v=$("#search-term-match"),w=C.find('[name="align"] + .selectize-control .item');v.text(w.text());var g=$("#search-types-serialize"),N=C.find('[name="type[]"]:checked'),x=[];N.each(function(e,t){var i=$(t),a=i.closest("label");x.push(a.text().trim())});var k=x.join(", ");g.text(k);var S=$("#search-certification-serialize"),D=C.find('[name="certification"]:checked').closest("label").text();S.text(D);var T=C.find('[name="requirement[]"]:checked'),I=[];T.each(function(e,t){var i=$(t);I.push(i.data("short-label"))});var z=I.join(", ");$("#search-requirement-serialize").text(z)}},setCountryCapabilitiesInfoMessage:function(e){var t="",i=$(twilio.buyNumber.capabilitiesMessageSelector);if(e.sms||e.mms||e.voice)if(e.sms||e.mms){if(e.voice)return i.addClass(twilio.buyNumber.HIDDEN_CLASS),!1;t=twilio.buyNumber.getCountryCapabilitiesInfoMessage("This country does <strong>not</strong> have voice numbers.","https://support.twilio.com/hc/en-us/articles/226691348")}else t=twilio.buyNumber.getCountryCapabilitiesInfoMessage("This country does <strong>not</strong> have SMS and MMS numbers.","https://support.twilio.com/hc/en-us/articles/226690868");else t=twilio.buyNumber.getCountryCapabilitiesInfoMessage("We're currently unable to stock phone numbers in this country.","https://support.twilio.com/hc/en-us/articles/226691528");return i.find(".alert").html(t),i.removeClass(twilio.buyNumber.HIDDEN_CLASS),!0},getCountryCapabilitiesInfoMessage:function(e,t){return e+' <a href="'+t+'" class="text-info external-link" target="_blank"><strong>Learn more</strong><i class="icon icon-twilio-external-link text-middle m-l-xs"></i></a>'},updateCurrentCountry:function(e){twilio.buyNumber.isUpdatingCountry=!0;var t=twilio.buyNumber.currentCountry,i=twilio.buyNumber.countryData[e];"undefined"!=typeof i&&(twilio.buyNumber.currentCountry=i),t&&i&&t.isoCode!=i.isoCode&&!t.beta&&i.beta&&$(twilio.buyNumber.betaCheckboxSelector).prop("checked",!0),twilio.buyNumber.updateForm();var a=$("select.country").length;$("select.country").each(function(t){$(this).val()!=e&&this.selectize.setValue(e),t==a-1&&(twilio.buyNumber.isUpdatingCountry=!1)})},processResponseCallback:function(e){var t=$(twilio.buyNumber.modalSelector),i=t.find(".modal-body").last();if(e.error||e.fatal){var a=e.error?e.error:e.fatal;twilio.alert["new"]("danger",a,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i&&i.parents(".modal").modal("refresh")}else e.reload?window.location.reload():e.location?window.location=e.location:(t.modal("push",$(e.html),"Congratulations"),t.find(".back.btn").hide())},addAddressCallback:function(e){var t=$(twilio.addAddress.modalSelector),i=t.find(".modal-body").last();if(e.error||e.fatal){var a=e.error?e.error:e.fatal;twilio.alert["new"]("danger",a,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i&&i.parents(".modal").modal("refresh")}else if(e.reload)window.location.reload();else if(e.location)window.location=e.location;else{var r=$(e).find(".modal-body").wrap("<div/>").parent().html()+$(e).find(".modal-footer").wrap("<div/>").parent().html();t.attr("role",$(e).attr("role")),t.modal("push",$(r),"Buy This Number?"),t.find(".back.btn").hide()}},updateSearchType:function(e){var t=$('select[name="searchType"]'),i=$('input[name="searchTerm"]:not(.condensedSearch input)'),a=$(".match-drop-down"),r=$(".search-term-help"),o=$(".match-to-wrapper"),l=$(".number-drop-down:not(.condensedSearch .number-drop-down)");e&&i.val(""),"location"==t.val()?(i.attr("placeholder","Search by location e.g. Boston (Optional)"),a.hide(),r.hide(),o.hide(),l.removeClass("col-sm-14").addClass("col-sm-15")):(i.attr("placeholder","Search by digits or phrases (Optional)"),a.show(),r.show(),o.show(),l.removeClass("col-sm-15").addClass("col-sm-14"))},keepCapabilityDisabled:function(e){twilio.buyNumber.disabledCapabilities.indexOf(e)==-1&&twilio.buyNumber.disabledCapabilities.push(e)},isCapabilityKeptDisabled:function(e){return twilio.buyNumber.disabledCapabilities.indexOf(e)!=-1}},twilio.buyNumber.countryData=twilio.buyNumber.countryData||{},$(function(){"undefined"!=typeof twilio&&"undefined"!=typeof twilio.buyNumber&&twilio.buyNumber.init()});
//# sourceMappingURL=buy-numbers.js.map
