$(function(){$("body").on("loaded","@number-modals",function(){$(this).find("select").selectize({create:!0,dropdownParent:"body"}),$("@radio-tab").click(function(){$(this).tab("show")})})});var twilio=twilio||{};twilio.associateNumberModal={chunkSize:25,selector:"#associate-number-modal",shortcodeModalSelector:"#associate-shortcode-modal",addButtonSelector:"@add-selected-numbers",init:function(){$("body").on("click","@numbers-clear-filter",function(e){$("input@propertyValue").val(""),$("@modal-associate-number").submit()}).on("click",twilio.associateNumberModal.addButtonSelector,function(){$(twilio.associateNumberModal.addButtonSelector).button("loading");var e=$('input[data-group="associate-selected-numbers"]:checked'),o=[];e.each(function(){var e=$(this),i=e.val(),t=e.data("display");o.push({sid:i,display:t})}),twilio.associateNumberModal.associateNumbers(o,null,null,twilio.associateNumberModal.finishedAssociatingNumbers)})},finishedAssociatingNumbers:function(e,o){var i=$("#contextSid").val();twilio.associateNumberModal.refreshTableData(),$.get("/console/phone-numbers/incoming/modals/list/"+i,function(i){twilio.associateNumberModal.refreshContent(i);var t=$(twilio.associateNumberModal.selector).find(".modal-body");if(e.length){var a="Successfully added numbers: "+twilio.associateNumberModal.getNumberListDisplay(e);twilio.alert["new"]("success",a,t,{method:"prepend",clear:!0})}if(o.length){var l="Sorry, these numbers could not be added at this time: "+twilio.associateNumberModal.getNumberListDisplay(o);twilio.alert["new"]("danger",l,t,{method:"prepend"})}})},finishedAssociatingShortcode:function(e){if(e.success)$(twilio.associateNumberModal.shortcodeModalSelector).modal("hide"),twilio.alert["new"]("success",e.success?e.success:"Successfully added shortcode to this Messaging Service."),twilio.associateNumberModal.refreshTableData();else{var o=$(twilio.associateNumberModal.shortcodeModalSelector).find(".modal-body");twilio.alert["new"]("error",e.error?e.error:"An unexpected error occurred and your shortcode was not added, please try again later.",o,{method:"prepend"})}},getNumberListDisplay:function(e){if(e.length<=3)return e.join(", ");var o=e.slice(0,3);return o.join(", ")+", and "+String(e.length-3)+" more"},associateNumbers:function(e,o,i,t){var a=[],l=[],r=$("#contextSid").val(),d=$.Deferred().done(t);twilio.associateNumberModal._associateNumbers(d,e,r,o,i,a,l)},_associateNumbers:function(e,o,i,t,a,l,r){if(!o.length)return void e.resolve(l,r);for(var d=o.splice(0,twilio.associateNumberModal.chunkSize),s=[],n=0;n<d.length;n++){var u=d[n];s.push(twilio.associateNumberModal.createAssociateRequest(i,u,function(e){e.success?("function"==typeof t&&t(e),l.push(e.displayNumber)):("function"==typeof a&&a(e),r.push(e.displayNumber))}))}$.when.apply($,s).done(function(){twilio.associateNumberModal._associateNumbers(e,o,i,t,a,l,r)})},createAssociateRequest:function(e,o,i){var t="";return o.sid?t="?numberSid="+o.sid:o.display&&(t="?number="+o.display),$.post("/console/phone-numbers/incoming/associate/"+e+t,i)},refreshTableData:function(){$("body").trigger("refreshData")},refreshContent:function(e){var o=$(twilio.associateNumberModal.selector),i=o.find(".modal-body").last();i.replaceWith($(e).find(".modal-body")),twilio.init.initSelectize();var t=$.Event("loaded");i.trigger(t),$("body").trigger(t)},buyNumber:function(e){var o=$(twilio.associateNumberModal.selector),i=o.find(".modal-body").last();if(e.error||e.fatal){var t=e.error?e.error:e.fatal;twilio.alert["new"]("danger",t,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i&&i.parents(".modal").modal("refresh")}else if(e.reload)window.location.reload();else if(e.location)window.location=e.location;else{var a=$(e).find(".modal-body").wrap("<div/>").parent().html()+$(e).find(".modal-footer").wrap("<div/>").parent().html();o.attr("role",$(e).attr("role")),o.modal("push",$(a),"Buy a Number"),o.find(".back.btn").hide()}}},$(function(){twilio.associateNumberModal&&twilio.associateNumberModal.init()});var twilio=twilio||{};twilio.bulkAddModal={selector:"#bulk-associate-number-modal",textBoxSelector:'textarea[name="numbers"]',processButtonSelector:"@process-numbers",progressBarSelector:"@numbers-progress-bar",doneButtonSelector:"@bulk-done-button",viewErrorsButtonSelector:"@view-errors-button",processingCompleteSelector:"@processing-complete",successCountSelector:"@numbers-added-count",$successCount:null,failedCountSelector:"@numbers-failed-count",$failedCount:null,processedCountSelector:"@numbers-processed-count",$processedCount:null,isProcessing:!1,errors:null,init:function(){$("body").on("click",twilio.bulkAddModal.processButtonSelector,function(){return $(twilio.bulkAddModal.textBoxSelector).val()?($(twilio.bulkAddModal.processButtonSelector).button("loading"),void $.get("/console/phone-numbers/incoming/modals/bulk/progress",twilio.bulkAddModal.showProgress)):void twilio.alert["new"]("error","No numbers specified.",$(twilio.bulkAddModal.selector).find(".modal-body"),{method:"prepend",clear:!0})}).on("hidden.bs.modal",twilio.bulkAddModal.selector,function(){twilio.bulkAddModal.isProcessing&&location.reload()}).on("click",twilio.bulkAddModal.viewErrorsButtonSelector,twilio.bulkAddModal.viewErrors)},initProgressElements:function(){twilio.bulkAddModal.$successCount=$(twilio.bulkAddModal.successCountSelector),twilio.bulkAddModal.$failedCount=$(twilio.bulkAddModal.failedCountSelector),twilio.bulkAddModal.$processedCount=$(twilio.bulkAddModal.processedCountSelector)},initNewProcess:function(e){twilio.bulkAddModal.initProgressElements(),twilio.bulkAddModal.errors=[],twilio.bulkAddModal.totalCount=e,twilio.bulkAddModal.isProcessing=!0},showProgress:function(e){var o=$(twilio.bulkAddModal.selector);if(e.success){o.modal("push",$(e.html),"Processing Numbers"),o.find(".back.btn").addClass("hidden");var i=$(twilio.bulkAddModal.textBoxSelector).val();i=i.split(/[\n]+/);for(var t=0;t<i.length;t++)i[t]={sid:null,display:i[t]};twilio.bulkAddModal.initNewProcess(i.length),twilio.associateNumberModal.associateNumbers(i,twilio.bulkAddModal.numberSucceeded,twilio.bulkAddModal.numberFailed,twilio.bulkAddModal.finishedAddingNumbers)}else twilio.alert["new"]("error",e.error?e.error:"There was a problem processing your numbers at this time, please try again later.",o.find(".modal-body"),{method:"prepend"})},numberSucceeded:function(){twilio.bulkAddModal.$successCount.html(parseInt(twilio.bulkAddModal.$successCount.html(),10)+1),twilio.bulkAddModal.incrementProcessed()},numberFailed:function(e){twilio.bulkAddModal.errors.push(e),twilio.bulkAddModal.$failedCount.html(parseInt(twilio.bulkAddModal.$failedCount.html(),10)+1),twilio.bulkAddModal.incrementProcessed()},incrementProcessed:function(){var e=parseInt(twilio.bulkAddModal.$processedCount.html(),10)+1;twilio.bulkAddModal.$processedCount.html(e),$(twilio.bulkAddModal.progressBarSelector).css("width",String(e/twilio.bulkAddModal.totalCount*100)+"%")},finishedAddingNumbers:function(){twilio.bulkAddModal.isProcessing=!1,$(twilio.bulkAddModal.progressBarSelector).removeClass("active"),$(twilio.bulkAddModal.processingCompleteSelector).removeClass("hidden"),twilio.bulkAddModal.errors&&twilio.bulkAddModal.errors.length?($(twilio.bulkAddModal.doneButtonSelector).addClass("hidden"),$(twilio.bulkAddModal.viewErrorsButtonSelector).removeClass("hidden")):$(twilio.bulkAddModal.doneButtonSelector).html("Done").prop("disabled",!1),twilio.associateNumberModal.refreshTableData()},viewErrors:function(){$(twilio.bulkAddModal.viewErrorsButtonSelector).button("loading"),$.get("/console/phone-numbers/incoming/modals/bulk/errors",function(e){$(twilio.bulkAddModal.viewErrorsButtonSelector).button("reset");var o=$(twilio.bulkAddModal.selector);e.success?(o.modal("push",$(e.html),String(twilio.bulkAddModal.errors.length)+" Numbers With Errors"),twilio.bulkAddModal.populateErrorsTable(),o.modal("refresh")):twilio.alert["new"]("error",e.error?e.error:"Sorry, there was a problem loading the errors.",o.find(".modal-body"),{method:"prepend"})})},populateErrorsTable:function(){for(var e=$("@errors-table"),o=0;o<twilio.bulkAddModal.errors.length;o++){var i=twilio.bulkAddModal.errors[o];e.append("<tr><td>"+twilio.strings.sanitize(i.displayNumber)+"</td><td>"+twilio.strings.sanitize(i.error)+"</td></tr>")}}},$(function(){twilio.bulkAddModal&&twilio.bulkAddModal.init()});var twilio=twilio||{};twilio.buyNumberModal={initialized:!1,selector:"@buy-number-modal",searchSubmitButtonSelector:"@submit-search-form",buyNumberFilterParamsSelector:"@buyFilterParams",trialNumberModalSelector:"#trial-number-modal",buyNumberFilterParams:{},currentFormType:"basic",typeToAssociate:"",sidToAssociate:"",isTrialModal:!1,TYPE_SIP_TRUNK:"SIP Trunk",TYPE_MESSAGING_GATEWAY:"Messaging Service",HIDDEN_CLASS:"hide",trialNumberInit:function(){$("#submit-trial-phone-number").removeClass("disabled")},init:function(e){if(!twilio.buyNumberModal.initialized){twilio.buyNumberModal.initialized=!0,twilio.buyNumber.init();var o=$(twilio.buyNumberModal.buyNumberFilterParamsSelector);1==o.length&&(twilio.buyNumberModal.buyNumberFilterParams=JSON.parse(o.val())),twilio.buyNumberModal.identifyAssociatedObject(),twilio.buyNumberModal.loadCustomFilters(),twilio.buyNumberModal.eventHandlers()}$("@tooltip").tooltip().on("show",function(e){e.stopPropagation()}).on("hidden",function(e){e.stopPropagation()})},copyCapabilityCheckboxesState:function(e){e.find("label.anyCapability, label.sms, label.mms, label.voice").each(function(){var e=$(this),o=e.find("input"),i=o.attr("id").split("-"),t=i[0],a=i[1],l="basic"==a?"advanced":"basic",r="#"+t+"-"+l,d=$(r),s=d.parent();e.hasClass("checked")?(d.prop("checked",!0),s.addClass("checked")):(d.prop("checked",!1),s.removeClass("checked"))})},eventHandlers:function(){$(twilio.buyNumberModal.selector).on("hide.bs.modal",function(){$(this).find(".modal-body.purchase-complete").length&&window.location.reload()}).on("hidden.bs.modal",function(){twilio.buyNumberModal.initialized=!1}),$("body").off("click").on("click","@swap",function(e){e.preventDefault();var o=$(this),i=$("#basicSearch"),t=$("#advancedSearch");i.hasClass(twilio.buyNumberModal.HIDDEN_CLASS)?(twilio.buyNumberModal.currentFormType="advanced",twilio.buyNumberModal.copyCapabilityCheckboxesState(t),o.text("Advanced Search"),i.removeClass(twilio.buyNumberModal.HIDDEN_CLASS),t.addClass(twilio.buyNumberModal.HIDDEN_CLASS),twilio.buyNumberModal.updateHeight()):(twilio.buyNumberModal.currentFormType="basic",twilio.buyNumberModal.copyCapabilityCheckboxesState(i),o.text("Hide Advanced Search"),t.removeClass(twilio.buyNumberModal.HIDDEN_CLASS),i.addClass(twilio.buyNumberModal.HIDDEN_CLASS),twilio.buyNumberModal.updateHeight())}).on("click",twilio.buyNumberModal.searchSubmitButtonSelector,function(e){e.preventDefault(),$(twilio.buyNumberModal.searchSubmitButtonSelector).button("loading"),$("@search-form-"+twilio.buyNumberModal.currentFormType).submit()}).on("click","@buy-another-number",function(e){e.preventDefault(),$(twilio.buyNumberModal.selector).modal("pop",2),$("@search-form-condensed").submit()}).on("change",'input[name="searchTerm"]',function(){var e=$(this).val();$('input[name="searchTerm"]').each(function(){$(this).val!==e&&$(this).val(e)})}).on("change",'select[name="searchType"]',function(){var e=$(this).val();$('select[name="searchType"]').each(function(){$(this).val()!==e&&this.selectize.setValue(e)}),twilio.buyNumberModal.updateHeight()})},identifyAssociatedObject:function(){var e,o=window.location.pathname;if(e=o.match(/^\/console\/sip-trunking\/trunks\/(TK[a-z0-9]{32})\/numbers$/)){var i=e[1];twilio.buyNumberModal.typeToAssociate=twilio.buyNumberModal.TYPE_SIP_TRUNK,twilio.buyNumberModal.sidToAssociate=i}else o.match(/^\/console\/sms\/services\/(MG[a-z0-9]{32})\/numbers$/)&&(twilio.buyNumberModal.typeToAssociate=twilio.buyNumberModal.TYPE_MESSAGING_GATEWAY,twilio.buyNumberModal.sidToAssociate=$("@number-pool-sid").val())},loadCustomFilters:function(){if(twilio.buyNumberModal.typeToAssociate==twilio.buyNumberModal.TYPE_SIP_TRUNK){twilio.buyNumberModal.forceCheckCapability("voice");var e=$("@search-form-basic"),o=$("@search-form-advanced"),i=$("@search-form-condensed"),t='<input type="hidden" name="capability[]" value="sip" checked="true">';e.find('input[name="capability[]"][value="sip"]').length||e.append(t),o.find('input[name="capability[]"][value="sip"]').length||o.append(t),i.find('input[name="capability[]"][value="sip"]').length||i.append(t)}else twilio.buyNumberModal.typeToAssociate==twilio.buyNumberModal.TYPE_MESSAGING_GATEWAY?twilio.buyNumberModal.forceCheckCapability("sms"):twilio.buyNumberModal.buyNumberFilterParams&&twilio.buyNumberModal.buyNumberFilterParams.capabilities&&$.each(twilio.buyNumberModal.buyNumberFilterParams.capabilities,function(e,o){twilio.buyNumberModal.forceCheckCapability(o,!0)})},processResponseCallback:function(e){$(twilio.buyNumberModal.searchSubmitButtonSelector).button("reset");var o=$(twilio.buyNumberModal.selector),i=o.find(".modal-body").last();if(e.error||e.fatal){var t=e.error?e.error:e.fatal;twilio.alert["new"]("danger",t,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i&&i.parents(".modal").modal("refresh")}else if(e.reload)window.location.reload();else if(e.location)window.location=e.location;else{var a=$(".search-results"),l=$(".search-results-footer");if(a.length>0){var r=$(e).find(".search-results"),d=$(e).find(".search-results-footer");a.replaceWith(r),l.replaceWith(d)}else{var s=$(e).find(".modal-body").wrap("<div/>").parent().html()+$(e).find(".modal-footer").wrap("<div/>").parent().html();o.modal("push",$(s),"Buy A Number - Search Results"),$(".number-form").css("display","")}o.find(".search-results-footer").closest(".modal-footer").find(".back.btn").hide();$("<button />").addClass("btn btn-link pull-left").html("❮ Revise Search").attr("data-pop","modal").prependTo($(".search-results-footer"));twilio.buyNumberModal.updateHeight(),twilio.buyNumberModal.initSearchResults()}},confirmBuyCallback:function(e){var o=$(twilio.buyNumberModal.selector),i=o.find(".modal-body").last();if(e.error||e.fatal){var t=e.error?e.error:e.fatal;twilio.alert["new"]("danger",t,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i&&i.parents(".modal").modal("refresh")}else if(e.reload)window.location.reload();else if(e.location)window.location=e.location;else if($(e).is("#confirm-buy-number-modal")){var a=$(e).find(".modal-body").wrap("<div/>").parent().html()+$(e).find(".modal-footer").wrap("<div/>").parent().html();if(o.modal("push",$(a),"Buy This Number?"),twilio.buyNumberModal.sidToAssociate){var l=$("@purchase-number-form"),r=l.attr("action");l.attr("action",r+"&sidToAssociate="+twilio.buyNumberModal.sidToAssociate)}}else $(e).is("#add-address-modal")&&twilio.buyNumberModal.pushAddressModal(e,o)},confirmTrialNumberCallback:function(e){var o=$(twilio.buyNumberModal.selector);o.length||(o=$(twilio.buyNumberModal.trialNumberModalSelector));var i=o.find(".modal-body").last();if(e.error||e.fatal){var t=e.error?e.error:e.fatal;twilio.alert["new"]("danger",t,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i&&i.parents(".modal").modal("refresh"),e.phoneNumberUnavailable&&twilio.buyNumberModal.handlePhoneNumberNotAvailable(o)}else e.reload?window.location.reload():e.location?window.location=e.location:e.push?(o.modal("push",$(e.html),e.title),o.find(".back.btn").hide()):$(e).is("#add-address-modal")?twilio.buyNumberModal.pushAddressModal(e,o):e.sid&&$('<form method="post" action="/console/phone-numbers/trial-number/provision/'+e.sid+'" role="ajax"data-done="twilio.buyNumberModal.confirmTrialNumberCallback"></form>').appendTo("body").submit()},handlePhoneNumberNotAvailable:function(e){var o=200,i=3e3;setTimeout(function(){e.find('button[type="submit"]').attr("disabled",!0)},o),setTimeout(function(){$(".js-get-first-number").click(),e.one("hidden",function(e){$(this).remove()}),e.modal("hide"),e.find(".back.btn").modal("hide")},i)},pushAddressModal:function(e,o){var i=$(e).find(".modal-body").wrap("<div/>").parent().html()+$(e).find(".modal-footer").wrap("<div/>").parent().html();o.modal("push",$(i),"Address Required"),$("@popover").popover(),$("@popover").on("hidden",function(e){e.stopPropagation()}),$("#address-from").find("select").selectize({dropdownParent:"body",render:{option:twilio.addAddress.renderOption,item:twilio.addAddress.renderOption}})},addAddressCallback:function(e){twilio.buyNumberModal.confirmBuyCallback(e)},purchasedNumberCallback:function(e){var o=$(twilio.buyNumberModal.selector),i=o.find(".modal-body").last();if(e.error||e.fatal){var t=e.error?e.error:e.fatal;twilio.alert["new"]("danger",t,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i&&i.parents(".modal").modal("refresh")}else if(e.reload)window.location.reload();else if(e.location)window.location=e.location;else{if(o.modal("push",$(e.html),"Number Purchased"),o.find(".back.btn").hide(),twilio.buyNumberModal.typeToAssociate&&twilio.buyNumberModal.sidToAssociate){var a;twilio.buyNumberModal.typeToAssociate==twilio.buyNumberModal.TYPE_SIP_TRUNK?a=$("@trunk-display-name").text():twilio.buyNumberModal.typeToAssociate==twilio.buyNumberModal.TYPE_MESSAGING_GATEWAY&&(a=$("@gateway-display-name").text()),$("@associate-info").html("This number has been associated with this "+twilio.buyNumberModal.typeToAssociate+(a?' <span class="text-muted">('+a+")</span>":"")),$("body").one("hide.bs.modal",twilio.buyNumberModal.selector,twilio.buyNumberModal.refreshTableData)}twilio.buyNumberModal.updateHeight()}},updateHeight:function(){$(twilio.buyNumberModal.selector).modal("refresh")},initSearchResults:function(){twilio.buyNumberModal.loadCustomFilters();var e=$(".search-results select.country");e.selectize({render:{option:twilio.buyNumber.renderOption,item:twilio.buyNumber.renderCondensedOption},onChange:function(e){twilio.buyNumber.updateCurrentCountry(e)}}),$("select").selectize(),$("@tooltip").tooltip().on("show",function(e){e.stopPropagation()}).on("hidden",function(e){e.stopPropagation()}),twilio.buyNumber.updateCurrentCountry(e.val()),twilio.buyNumber.highlightSearchTerm(),twilio.buyNumber.updateSearchType(!1)},refreshTableData:function(){$("body").trigger("refreshData")},forceCheckCapability:function(e,o){twilio.buyNumber.keepCapabilityDisabled(e);var i=$("#"+e+"-basic"),t=$("#"+e+"-advanced");i.prop("checked",!0),t.prop("checked",!0),o||(i.attr("disabled",!0),t.attr("disabled",!0));var a=$("@search-form-basic"),l=$("@search-form-advanced"),r='<input type="hidden" name="capability[]" value="'+e+'" checked="true">';a.find('input[type="hidden"][name="capability[]"][value="'+e+'"]').length||a.append(r),l.find('input[type="hidden"][name="capability[]"][value="'+e+'"]').length||l.append(r);var d=$("#anyCapability-basic"),s=$("#anyCapability-advanced");d.closest('div[class^="col-"]').remove(),s.closest('div[class^="col-"]').remove(),$(".capabilities-divider").remove()}},$(function(){twilio.buyNumberModal.trialNumberInit(),$("body").on("shown.bs.modal",twilio.buyNumberModal.selector,twilio.buyNumberModal.init).on("shown.bs.modal",twilio.buyNumberModal.trialNumberModalSelector,twilio.buyNumberModal.trialNumberInit).on("pushed.bs.modal",twilio.buyNumberModal.trialNumberModalSelector,function(e){var o=$(this);o.find("@trial-confirmation").length?o.on("hidden.bs.modal",function(){window.location.reload()}):o.find(".search-results-footer").length||($(e.target).attr("role","modal buy-number-modal"),twilio.buyNumberModal.isTrialModal=!0,twilio.buyNumberModal.initialized=!1,twilio.buyNumberModal.init(),o=$(twilio.buyNumberModal.selector),o.find(".back.btn").text("❮ Go back to your preselected number"))})});var twilio=twilio||{};twilio.validateAddress={modalSelector:"@validate-address-modal",suggestedAddressForm:"#suggestedAddress",init:function(){var e=$(twilio.validateAddress.modalSelector);e.on("hide.bs.modal",function(){window.location.reload()})},processValidationResponseCallback:function(e){var o=$(twilio.validateAddress.modalSelector);if(e.error||e.fatal){var i=o.find(".modal-body"),t=e.error?e.error:e.fatal;twilio.alert["new"]("danger",t,i,{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i.closest(".modal").modal("refresh")}else o.modal("push",$(e.html)),$("@use-suggested-address").on("click",function(){twilio.validateAddress.useAddressHandler(twilio.validateAddress.suggestedAddressForm)})},useAddressHandler:function(e){var o=$(this);o.button("loading"),$.ajax({type:"POST",url:"/console/phone-numbers/addresses",data:$(e).serialize()}).done(function(e){o.button("reset"),twilio.validateAddress.processSaveResponseCallback(e)})},processSaveResponseCallback:function(e){var o=$(twilio.validateAddress.modalSelector);if(e.error||e.fatal){var i=o.find(".modal-body"),t=e.error?e.error:e.fatal;twilio.alert["new"]("danger",t,i[1],{clear:!0,method:"prepend",dismissible:!1,fatal:!!e.fatal}),i.closest(".modal").modal("refresh")}else window.location.reload()}},$(function(){twilio.validateAddress.init()});
//# sourceMappingURL=numbers-modals.js.map
